image: golang:latest

stages:
  - build
  - test

variables:
  GO_PROJECT: gitlab.informatika.org/if3250-k01-g07/assesment-system/icando-ae-api

before_script:
  - mkdir -p $GOPATH/src/$(dirname $GO_PROJECT)
  - ln -svf $CI_PROJECT_DIR $GOPATH/src/$GO_PROJECT
  - cd $GOPATH/src/$GO_PROJECT/icando-ae-api

build:
  stage: build
  script:
    - go build -o ./main ./cmd/server/server.go
  artifacts:
    paths:
      - ./icando-ae-api/main

test:
  stage: test
  before_script:
    - cd icando-ae-api
    - source .env
  script:
    - cd icando-ae-api
    - go test -v ./...
